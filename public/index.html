<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>drafts</title>
  <!--
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/2.1.0/normalize.min.css">
  -->
  <link rel="stylesheet" href="/vendor/normalize.css">
  <link rel="stylesheet" href="/css/index.css">
  <!--
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.7/angular.min.js"></script>
  -->
  <script src="/vendor/angular.js"></script>
  <script src="/vendor/engine.io.js"></script>
  <script src='https://cdn.firebase.com/v0/firebase.js'></script>
  <script src="/js/index.js"></script>
</head>
<body ng-app="app" ng-cloak>
  <ng-view></ng-view>
  <div id="chat">
    <div id="messages"></div>
    <input id="message" placeholder="message" autofocus>
  </div>
  <script>
    function pushMessage(e) {
      if (e.keyCode !== 13) return;
      var text = this.value.slice(0, 1023);
      if (!text) return;
      var name = localStorage.name || 'undefined';
      var time = Firebase.ServerValue.TIMESTAMP;
      fire.push({ name: name, text: text, time: time });
      this.value = '';
    }
    function displayMessage(snapshot) {
      var val = snapshot.val();
      var div = d.createElement('div');
      var date = new Date(val.time);
      function pad(n) { return ('0' + n).slice(-2); }
      var time = pad(date.getHours()) + ':' + pad(date.getMinutes());
      div.textContent = time + ' ' + val.name + ': ' + val.text;
      messages.appendChild(div);
      div.scrollIntoView();
    }

    if (location.pathname === '/') {
      var fire = new Firebase('https://draft.firebaseio.com/');
      var query = fire.limit(15);
      query.on('child_added', displayMessage);
      document.getElementById('message').addEventListener('keypress', pushMessage);
      var d = document;
      var messages = d.getElementById('messages');
    }
  </script>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37231502-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42526090-1', 'drafts.in');
    ga('send', 'pageview');

  </script>
</body>
</html>
