Draft = require \./draft
Sock = require \./sock

drafts = {}

rm = ->
  delete drafts[@id]


router =
  create: (opts) ->
    draft = new Draft opts
    drafts[draft.id] = draft
    draft.on \end rm
    draft.id
  connect: (ws) ->
    sock = new Sock ws
    {room} = sock

    if draft = drafts[room]
      draft.join sock
    else
      sock.send \error 'room not found'

module.exports = router
